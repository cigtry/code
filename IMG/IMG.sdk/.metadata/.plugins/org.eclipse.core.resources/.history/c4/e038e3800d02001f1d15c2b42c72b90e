#include "xil_printf.h"
#include "ff.h"
#include "sd_card.h"
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "xil_io.h"
#include "xparameters.h"
#include "xil_types.h"
#include "xil_cache.h"
#include "ff.h"
#include "xdevcfg.h"
#include "picture.h"

#define H_STRIDE            1280
#define H_ACTIVE            1280
#define V_ACTIVE            720
#define VIDEO_LENGTH  (H_STRIDE*V_ACTIVE)

#define VDMA_BASEADDR   XPAR_AXI_VDMA_0_BASEADDR
#define VIDEO_BASEADDR0 0x08000000
#define BUF_SIZE ((H_STRIDE*V_ACTIVE)*3)



void VDMA_init()
{
	u32 x=0;
	u32 y=0;
	u32 r,g,b;
	u32 i=0,j=0;
	for(y=0;y<V_ACTIVE;y++)
	{
		for(x=0;x<H_ACTIVE;x++)
		{

			b = gImage_picture[i+2];
			g = gImage_picture[i+1];
			r = gImage_picture[i];
			i+=3;

			Xil_Out32((VIDEO_BASEADDR0+j),((r<<16)|(g<<8)|(b<<0)));
			j+=4;

		}
	}
	//Xil_DCacheFlush();
	Xil_Out32((VDMA_BASEADDR + 0x000), 0x3);//0011
	Xil_Out32((VDMA_BASEADDR + 0x05c), VIDEO_BASEADDR0);
	Xil_Out32((VDMA_BASEADDR + 0x060), VIDEO_BASEADDR0);
	Xil_Out32((VDMA_BASEADDR + 0x064), VIDEO_BASEADDR0);
	Xil_Out32((VDMA_BASEADDR + 0x058), (H_STRIDE*4));
	Xil_Out32((VDMA_BASEADDR + 0x054), (H_ACTIVE*4));
	Xil_Out32((VDMA_BASEADDR + 0x050), V_ACTIVE);

}



int main()
{



		VDMA_init();
		Xil_DCacheFlush();
}
