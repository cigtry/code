#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "xil_io.h"
#include "xparameters.h"
#include "xil_types.h"
#include "xil_cache.h"
#include "ff.h"
#include "xdevcfg.h"
#in

#define FILE_NAME "HAHA.txt"

const char src_str[30] = "kunkunzuibang";
static FATFS fatfs;

#define VDMA_BASEADDR XPAR_AXI_VDMA_0_BASEADDR
#define VDMA_BUFFER_0 0x08000000
#define STRIDE 1280
#define HSIZE  1280
#define VSIZE  720
#define VIDEO_LENTH ( HSIZE*VSIZE)



  void show_img( const unsigned char * addr , u32 size_x,u32 size_y)
  {
	  u32 x = 0;
	  u32 y = 0;
	  u32 r,g,b;
	  for(y = size_y ; y >0;y--)
	  {
		  for(x = 0 ; x < size_x;x++)
		  	  {
		  		  b = * (addr++);
		  		  g = * (addr++);
		  		  r = * (addr++);
		  		  Xil_Out32((VDMA_BUFFER_0 + (((y - 1) * size_x)+x) *4),((r<<16)|(g << 8)|(b<<0)));
		  	  }
	  }
	  Xil_DCacheFlush();
  }

  void vdma_init()
  {
	  int i;
	  for (i = 0; i <VIDEO_LENTH ; i++)
	  {
		  Xil_Out32( VDMA_BUFFER_0 + i*4 , 0);
	  }
	Xil_DCacheFlush();
  	Xil_Out32(VDMA_BASEADDR,0x1);//开启vdma
    Xil_Out32(VDMA_BASEADDR+0x5c,VDMA_BUFFER_0);//设置vdma映射内存起始地址
  	Xil_Out32(VDMA_BASEADDR+0x58,STRIDE*3);//设置每行的
	Xil_Out32(VDMA_BASEADDR+0x54,HSIZE*3);//设置每行的像素宽度=像素数x像素字节数
  	Xil_Out32(VDMA_BASEADDR+0x50,VSIZE);//设置显示器高度像素数;

  }

int main(void)
{


	vdma_init();
	//platform_init_fs();
	//sd_mount();


	return 0;
}
